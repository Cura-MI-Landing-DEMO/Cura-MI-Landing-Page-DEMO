<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Disponibilit√† ‚Äì Operatore</title>
  <link rel="stylesheet" href="disponibilitaoperatore.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <!-- Banner DEMO -->
  <div id="demoBanner" class="demo-banner">
    ‚ö†Ô∏è Questa √® una <strong>DEMO dimostrativa</strong>. Non vengono raccolti dati sensibili.<br>
    <strong>Cura‚Äëmi</strong> √® in fase di costruzione, ma puoi gi√† dirci la tua<br>
    Rilascio previsto: <strong>2026</strong>. Provala Subito!
    <span class="demo-close" onclick="document.getElementById('demoBanner').style.display='none'">‚úï</span>
  </div>

  <div class="dashboard">
    <aside class="sidebar">
      <img class="logo" src="images/logocurami.png" alt="Logo Cura‚ÄëMI">
      <h2>DEMO - Operatore</h2>
      <a class="operator-id">Tessera: <strong>123456</strong></a>
      <a href="dashboardoperatore.html" class="nav-item active"><i class="fa-solid fa-calendar-day"></i>Home - Dashboard</a>
      <a href="prenotazioni.html"><i class="fa-solid fa-handshake-angle"></i> Prenotazioni gestite</a>
      <a href="pagamenti.html"><i class="fa-solid fa-credit-card"></i> Pagamenti</a>
      <a><i class="fa-solid fa-comment-dots"></i> Chat</a>
    </aside>

    <main class="main-dashboard">
      <h1>Gestione Disponibilit√†</h1>
      <button id="resetDemo" class="reset-btn">üîÅ Reset DEMO</button>

      <form class="availability-form">
        <h2>Disponibilit√† Operatore</h2>

        <div class="field-group">
          <label>Seleziona i giorni</label>
          <div class="day-checkboxes">
            <label><input type="checkbox" value="Lun"> Lun</label>
            <label><input type="checkbox" value="Mar"> Mar</label>
            <label><input type="checkbox" value="Mer"> Mer</label>
            <label><input type="checkbox" value="Gio"> Gio</label>
            <label><input type="checkbox" value="Ven"> Ven</label>
            <label><input type="checkbox" value="Sab"> Sab</label>
            <label><input type="checkbox" value="Dom"> Dom</label>
          </div>
        </div>

        <div class="times-section">
          <label>Fasce orarie per giorno</label>
          <div id="timesContainer"></div>
          <button type="button" id="addTime" class="add-time">+ Aggiungi fascia</button>
        </div>

        <div class="field-group">
          <label><input type="checkbox" id="inStudioFlag"> In studio</label>
          <label><input type="checkbox" id="homeFlag"> A domicilio</label>
        </div>

        <div class="field-group">
          <label>Settimana corrente</label>
          <div class="week-widget">
            <span id="weekDisplay"></span>
            <input type="hidden" id="weekCounter" />
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-submit">üíæ Salva Disponibilit√†</button>
        </div>
      </form>

      <div class="availability-summary">
        <h3>Disponibilit√† Inserite</h3>
        <ul id="weekList"></ul>
      </div>
    </main>
  </div>

  <div class="contact-icons">
    <a href="tel:+393331234567" class="icon-btn call" aria-label="Chiama">
      <i class="fa-solid fa-phone"></i>
    </a>
    <a href="https://wa.me/393331234567" target="_blank" class="icon-btn whatsapp" aria-label="WhatsApp">
      <i class="fa-brands fa-whatsapp"></i>
    </a>
  </div>

  <footer class="footer glass-footer">
    <div class="footer-content">
      <div class="footer-left">
        <a href="#">¬© 2025 Cura‚ÄëMI - info@cura‚Äëmi.it</a>
      </div>
      <div class="footer-center">
        <p class="demo-text">
          ‚ö†Ô∏è Questa √® una <strong>DEMO dimostrativa</strong>. Non vengono raccolti dati sensibili.<br>
          <strong>Cura‚Äëmi</strong> √® in fase di costruzione, ma puoi gi√† dirci la tua<br>
          Rilascio previsto: <strong>2026</strong>.
        </p>
      </div>
      <div class="footer-right">
        <a href="#">Privacy</a>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const weekdays = ['Lun','Mar','Mer','Gio','Ven','Sab','Dom'];
      const timesContainer = document.getElementById('timesContainer');
      const addTimeBtn = document.getElementById('addTime');
      const weekDisplay = document.getElementById('weekDisplay');
      const weekCounterInput = document.getElementById('weekCounter');
      const weekList = document.getElementById('weekList');
      const resetBtn = document.getElementById('resetDemo');
      const form = document.querySelector('.availability-form');
      const inStudioCheckbox = document.getElementById('inStudioFlag');
      const homeCheckbox = document.getElementById('homeFlag');
      const dateFormatter = new Intl.DateTimeFormat('it-IT', { day: 'numeric', month: 'long', year: 'numeric' });

      const getCurrentWeekIndex = () => {
        const baseDate = new Date(2025, 7, 25);
        const today = new Date();
        const diff = today - baseDate;
        return diff > 0 ? Math.floor(diff / (7 * 86400000)) : 0;
      };

      const calculateWeekRange = idx => {
        const base = new Date(2025, 7, 25);
        const monday = new Date(base);
        monday.setDate(base.getDate() + idx * 7);
        const sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        return `${dateFormatter.format(monday)} ‚Äì ${dateFormatter.format(sunday)}`;
      };

      let weekIndex = parseInt(localStorage.getItem('weekCounter')) || getCurrentWeekIndex();
      let log = JSON.parse(localStorage.getItem('weekLog')) || [];

      const updateWeekDisplay = () => weekDisplay.textContent = calculateWeekRange(weekIndex);
      const renderLog = () => {
        weekList.innerHTML = '';
        log.forEach(entry => {
          const li = document.createElement('li');
          li.textContent = entry;
          weekList.appendChild(li);
        });
      };

      addTimeBtn.addEventListener('click', () => {
        const div = document.createElement('div');
        div.className = 'time-pair';
        div.innerHTML = `
          <select class="day-select"><option value="">-- Giorno --</option>${weekdays.map(d => `<option>${d}</option>`).join('')}</select>
          <input type="time"> ‚Äì <input type="time">
          <button type="button" class="remove-time">‚úï</button>`;
        timesContainer.appendChild(div);
        div.querySelector('.remove-time').onclick = () => div.remove();
      });

      form.addEventListener('submit', e => {
        e.preventDefault();
        const selectedDays = Array.from(document.querySelectorAll('.day-checkboxes input:checked')).map(ch => ch.value);
        const timePairs = Array.from(timesContainer.querySelectorAll('.time-pair'));

        // Validazione: per ogni giorno selezionato deve esserci almeno 1 fascia oraria corrispondente
        const validDays = selectedDays.every(day =>
          timePairs.some(tp => tp.querySelector('.day-select').value === day)
        );

        if (!validDays) {
          alert('Devi inserire almeno una fascia oraria per ogni giorno selezionato.');
          return;
        }

        timePairs.forEach(tp => {
          const day = tp.querySelector('.day-select').value;
          const start = tp.querySelectorAll('input')[0].value;
          const end = tp.querySelectorAll('input')[1].value;
          const inStudioText = inStudioCheckbox.checked ? ' (In studio)' : '';
          const homeText = homeCheckbox.checked ? ' (A domicilio)' : '';
          if (day && start && end) {
            log.push(`${calculateWeekRange(weekIndex)} ‚Üí ${day}: ${start}‚Äì${end}${inStudioText}${homeText}`);
          }
        });

        inStudioCheckbox.checked = false;
        homeCheckbox.checked = false;
        weekIndex++;
        localStorage.setItem('weekCounter', weekIndex);
        localStorage.setItem('weekLog', JSON.stringify(log));
        updateWeekDisplay();
        renderLog();
        timesContainer.innerHTML = '';
      });

      resetBtn.addEventListener('click', () => {
  localStorage.removeItem('weekCounter');
  localStorage.removeItem('weekLog');
  weekIndex = getCurrentWeekIndex();
  log = [];
  updateWeekDisplay();
  renderLog();

  // ‚úÖ Reset form UI
  document.querySelectorAll('.day-checkboxes input').forEach(ch => ch.checked = false);
  inStudioCheckbox.checked = false;
  homeCheckbox.checked = false;
  timesContainer.innerHTML = '';
});


      updateWeekDisplay();
      renderLog();
    });
  </script>

</body>
</html>
