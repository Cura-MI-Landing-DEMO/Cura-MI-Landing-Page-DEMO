<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Operatore ‚Äì Cura‚ÄëMI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <link rel="stylesheet" href="dashboardoperatore.css"/>
  <style>
    body { overflow-x: hidden; }

    .pending-widget {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 30px;
    }
    .pending-card {
      background: #eefafa;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 140px;
    }
    .pending-card h4 { margin: 0 0 8px; font-size: 16px; color: #139395; }
    .card-detail { font-size: 13px; margin-bottom: 8px; color: #394e65; }
    .card-actions { display: flex; justify-content: space-between; gap: 4px; }
    .btn-op {
      flex: 1;
      padding: 6px;
      font-size: 13px;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .accept-btn { background: #28a745; }
    .reject-btn { background: #dc3545; }

    .contact-icons { right: 10px; }
  </style>
</head>
<body>
  <div class="demo-banner" role="status">
    <button class="demo-close" id="demoClose"><i class="fa-solid fa-xmark"></i></button>
    ‚ö†Ô∏è Questa √® una <strong>DEMO interattiva</strong>. Nessun dato reale viene raccolto. Provala Subito!
  </div>

  <div class="dashboard">
    <aside class="sidebar">
      <img class="logo" src="images/logocurami.png" alt="Logo Cura‚ÄëMI">
      <h2>DEMO ‚Äì Operatore</h2>
      <a class="operator-id">Tessera: <strong>123456</strong></a>
      <a href="disponibilitaoperatore.html"><i class="fa-solid fa-handshake-angle"></i> Disponibilit√†</a>
      <a href="prenotazioni.html">Prenotazioni Gestite</a>
      <a href="pagamenti.html">Pagamenti</a>
      <a href="index.html"><i class="fa-solid fa-right-from-bracket"></i> Esci</a>
    </aside>

    <main class="main-dashboard">
      <h1>Benvenuto, 123456</h1>
      <button class="reset-btn" onclick="resetPrenotazioni()">üîÑ Reset prenotazioni demo</button>

      <div class="cards-row">
        <div class="card"><h3>Prossima prenotazione</h3><p id="nextBooking">‚Äî</p></div>
        <div class="card"><h3>Totale prenotazioni</h3><p id="totalBookings">0</p></div>
        <div class="card"><h3>Utenti attivi</h3><p id="activeUsers">0</p></div>
      </div>

      <section class="pending-widget" id="pendingWidget"></section>

      <section class="chart-section">
        <h2>Statistiche orari disponibili</h2>
        <canvas id="availabilityChart" width="300" height="180"></canvas>
      </section>
    </main>
  </div>

  <div class="contact-icons">
    <a href="tel:+393331234567" class="icon-btn call"><i class="fa-solid fa-phone"></i></a>
    <a href="https://wa.me/393331234567" target="_blank" class="icon-btn whatsapp"><i class="fa-brands fa-whatsapp"></i></a>
  </div>

  <footer class="footer glass-footer">
    <div class="footer-content">
      <div class="footer-left"><a href="#">¬©‚ÄØ2025‚ÄØCura‚ÄëMI</a></div>
      <div class="footer-center"><p class="demo-text">Demo interattiva ‚Äì dati fittizi. Provala Subito!</p></div>
      <div class="footer-right"><a href="#">Privacy</a></div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  
  <script>
  new Chart(document.getElementById('availabilityChart'), {
    type: 'bar',
    data: {
      labels: ['Lun','Mar','Mer','Gio','Ven','Sab','Dom'],
      datasets: [{ data: [5,6,4,5,7,3,2], backgroundColor:'#FDC043' }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
  
  (function() {
    const widget = document.getElementById('pendingWidget'),
          KEY_PENDING = 'pendingBookings',
          KEY_HANDLED = 'handledBookings',
          KEY_PAY = 'payments',
          USER_KEY = 'userBookings';
    const elNext = document.getElementById('nextBooking'),
          elTotal = document.getElementById('totalBookings'),
          elActive = document.getElementById('activeUsers');
  
    function loadDefaults() {
      if (!localStorage.getItem(KEY_PENDING)) {
        const defaults = [];
        localStorage.setItem(KEY_PENDING, JSON.stringify(defaults));
      }
    }
  
    function renderCards() {
      const list = JSON.parse(localStorage.getItem(KEY_PENDING) || '[]');
      widget.innerHTML = '';
      list.forEach((b, i) => {
        const c = document.createElement('div');
        c.className = 'pending-card';
        c.innerHTML = `
          <h4>${b.date}</h4>
          <div class="card-detail">Servizio: ${b.service}</div>
          <div class="card-detail">Utente: ${b.user}</div>
          <div class="card-detail">Orario: ${b.time}</div>
          <div class="card-detail">Modalit√†: ${b.mode === 'domicilio' ? 'A domicilio' : 'In studio'}</div>
          <div class="card-detail">Note: ${b.notes || '‚Äì'}</div>
          <div class="card-detail">Pagamento: ${b.paymentMethod || 'Non indicato'}</div>
          <div class="card-actions">
            <button class="btn-op accept-btn" data-i="${i}">‚úî</button>
            <button class="btn-op reject-btn" data-i="${i}">‚úñ</button>
          </div>`;
        widget.appendChild(c);
      });
      updateStats();
    }
  
    function updateStats() {
      const pending = JSON.parse(localStorage.getItem(KEY_PENDING) || '[]'),
            handled = JSON.parse(localStorage.getItem(KEY_HANDLED) || '[]');
      elTotal.textContent = pending.length + handled.length;
      elActive.textContent = handled.length;
      elNext.textContent = pending[0]?.date || '‚Äî';
    }
  
    widget.onclick = e => {
      if (!e.target.matches('.btn-op')) return;
      const idx = e.target.dataset.i;
      const list = JSON.parse(localStorage.getItem(KEY_PENDING) || '[]');
      const b = list.splice(idx, 1)[0];
      b.status = e.target.classList.contains('accept-btn') ? 'Confermato' : 'Rifiutata';
      localStorage.setItem(KEY_PENDING, JSON.stringify(list));
  
      const handled = JSON.parse(localStorage.getItem(KEY_HANDLED) || '[]');
      handled.push(b);
      localStorage.setItem(KEY_HANDLED, JSON.stringify(handled));
  
      const userArr = JSON.parse(localStorage.getItem(USER_KEY) || '[]');
      const idxUser = userArr.findIndex(ub =>
        ub.date === b.date &&
        ub.service === b.service &&
        ub.time === b.time &&
        ub.paymentMethod === b.paymentMethod
      );
      if (idxUser > -1) {
        userArr[idxUser].status = b.status;
        localStorage.setItem(USER_KEY, JSON.stringify(userArr));
      }
  
      const pays = JSON.parse(localStorage.getItem(KEY_PAY) || '[]');
      pays.push({
        date: b.date,
        time: b.time,
        user: b.user,
        service: b.service,
        method: b.paymentMethod || 'Non specificato',
        amount: '‚Ç¨20',
        status: b.status
      });
      localStorage.setItem(KEY_PAY, JSON.stringify(pays));
  
      renderCards();
    };
  
    window.resetPrenotazioni = () => {
      if (confirm("Resettare dati demo?")) {
        localStorage.removeItem(KEY_PENDING);
        localStorage.removeItem(KEY_HANDLED);
        localStorage.removeItem(KEY_PAY);
        localStorage.removeItem(USER_KEY);
        location.reload();
      }
    };
  
    document.getElementById('demoClose').onclick = () => {
      document.querySelector('.demo-banner').style.display = 'none';
    };
  
    loadDefaults();
    renderCards();
  })();
  
</script>
  

  
</body>
</html>
